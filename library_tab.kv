#:import Window kivy.core.window.Window
#:import MDFillRoundFlatIconButton kivymd.uix.button.MDFillRoundFlatIconButton
#:import MDBottomNavigationItem kivymd.uix.bottomnavigation.MDBottomNavigationItem

<ScaledLabelLibrary@MDLabel>:
    # default body size; override per-usage where needed
    font_size: app.spx(14)

<PlaylistItem@BoxLayout>:
    pid: ""
    name: ""
    size_hint_y: None
    height: dp(48)
    padding: dp(4), 0
    spacing: dp(6)
    Button:
        text: root.name
        halign: "left"
        size_hint_x: 1
        on_release: app.root._playlist_on_select(root.pid)
    MDIconButton:
        icon: "dots-vertical"
        size_hint: None, None
        width: dp(36) if Window.width < dp(520) else dp(40)
        height: self.width
        icon_size: dp(18) if Window.width < dp(520) else dp(20)
        on_release: app.root._playlist_open_menu(root.pid, root.name)

<TrackItem@BoxLayout>:
    text: ""
    index: 0
    missing: False
    size_hint_y: None
    height: dp(56)
    padding: dp(4), 0
    spacing: dp(6)

    # LEFT: Title (single-line with ellipsis, never hidden)
    Button:
        text: root.text
        halign: "left"
        size_hint_x: 1
        disabled: root.missing
        on_release: app.root._playlist_play_index(root.index)
        shorten: True
        shorten_from: "right"
        text_size: (self.width - dp(12), None)

<PlaylistTrackRow>:
    # Data keys: text (str), index (int)
    orientation: "horizontal"
    size_hint_y: None
    height: dp(56)
    padding: dp(12), 0
    spacing: dp(10)

    # Title (left, stretches)
    MDLabel:
        text: root.text
        halign: "left"
        shorten: True
        shorten_from: "right"
        pos_hint: {"center_y": 0.5}
        size_hint_x: 1

    MDIconButton:
        id: delete_btn
        icon: "delete-outline"
        size_hint_x: None
        width: dp(48)
        pos_hint: {"center_y": 0.5}
        on_release: app.root._playlist_remove_track(root.index)


<LibraryTab@MDBottomNavigationItem>:
    # These ids are accessed from Python via self.library_tab.ids[...]
    name: "Screen 3"
    text: "Library"
    MDBoxLayout:
        size_hint: 1, 1
        orientation: "horizontal"
        padding: dp(8)
        spacing: dp(8)

        # LEFT: Playlists list
        MDCard:
            size_hint_y: 1
            radius: dp(16)
            min_width: dp(160)
            padding: dp(8)
            style: "filled"
            size_hint_x: 0.4
            MDBoxLayout:
                orientation: "vertical"
                spacing: dp(8)
                MDBoxLayout:
                    size_hint_y: None
                    height: dp(40)
                    MDLabel:
                        text: "Playlists"
                        bold: True
                        font_size: app.spx(12)
                    MDFillRoundFlatIconButton:
                        text: "New"
                        icon: "plus"
                        size_hint: None, None
                        adaptive_width: True
                        height: dp(34) if Window.width < dp(380) else (dp(38) if Window.width < dp(520) else dp(42))
                        icon_size: dp(16) if Window.width < dp(520) else dp(18)
                        font_size: sp(13) if Window.width < dp(520) else sp(15)
                        padding: [dp(12), 0] if Window.width < dp(520) else [dp(14), 0]
                        on_release: app.root._playlist_prompt_new()
                RecycleView:
                    id: rv_playlists
                    viewclass: "PlaylistItem"
                    data: []
                    RecycleBoxLayout:
                        default_size: None, dp(44) if Window.width < dp(520) else dp(52)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: "vertical"

        # RIGHT: Tracks of selected playlist
        MDCard:
            size_hint_y: 1
            radius: dp(16)
            padding: dp(8)
            style: "filled"
            size_hint_x: 0.65
            MDBoxLayout:
                orientation: "vertical"
                spacing: dp(8)

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(40)
                    MDLabel:
                        id: active_playlist_name
                        text: "Tracks"
                        bold: True
                        font_size: app.spx(12)
                    MDFillRoundFlatIconButton:
                        text: "Import"
                        icon: "file-plus"
                        size_hint: None, None
                        adaptive_width: True
                        height: dp(34) if Window.width < dp(380) else (dp(38) if Window.width < dp(520) else dp(42))
                        icon_size: dp(16) if Window.width < dp(520) else dp(18)
                        font_size: sp(13) if Window.width < dp(520) else sp(15)
                        padding: [dp(12), 0] if Window.width < dp(520) else [dp(14), 0]
                        on_release: app.root._playlist_import_selective()

                RecycleView:
                    id: rv_tracks
                    viewclass: "PlaylistTrackRow"
                    scroll_type: ['bars', 'content']
                    bar_width: dp(4) if Window.width < dp(520) else dp(6)
                    RecycleBoxLayout:
                        default_size: None, dp(44) if Window.width < dp(520) else dp(52)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'
