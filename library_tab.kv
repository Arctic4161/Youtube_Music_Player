
#:import MDFillRoundFlatIconButton kivymd.uix.button.MDFillRoundFlatIconButton
#:import MDBottomNavigationItem kivymd.uix.bottomnavigation.MDBottomNavigationItem

<PlaylistItem@BoxLayout>:
    pid: ""
    name: ""
    size_hint_y: None
    height: dp(48)
    padding: dp(4), 0
    spacing: dp(6)
    Button:
        text: root.name
        halign: "left"
        size_hint_x: 1
        on_release: app.root._playlist_on_select(root.pid)
    MDIconButton:
        icon: "dots-vertical"
        on_release: app.root._playlist_open_menu(root.pid, root.name)
        shorten: True
        shorten_from: "right"
        text_size: (self.width - dp(12), None)

<TrackItem@BoxLayout>:
    text: ""
    index: 0
    missing: False
    size_hint_y: None
    height: dp(56)
    padding: dp(4), 0
    spacing: dp(6)

    # LEFT: Title (single-line with ellipsis, never hidden)
    Button:
        text: root.text
        halign: "left"
        size_hint_x: 1
        disabled: root.missing
        on_release: app.root._playlist_play_index(root.index)
        shorten: True
        shorten_from: "right"
        text_size: (self.width - dp(12), None)

    # RIGHT: reserved area for badge + controls
    BoxLayout:
        orientation: "horizontal"
        size_hint_x: None
        width: dp(148)
        spacing: dp(6)

        MDLabel:
            text: "Missing"
            theme_text_color: "Error"
            opacity: 1 if root.missing else 0
            size_hint_x: None
            width: self.texture_size[0] if root.missing else 0
            valign: "middle"

        MDIconButton:
            icon: "arrow-up"
            tooltip_text: "Move up"
            on_release: app.root._playlist_move_up(root.index)
            disabled: root.index == 0

        MDIconButton:
            icon: "arrow-down"
            tooltip_text: "Move down"
            on_release: app.root._playlist_move_down(root.index)
            disabled: app.root._is_last_index(root.index)

        MDIconButton:
            icon: "delete"
            on_release: app.root._playlist_remove_track(root.index)

<LibraryTab@MDBottomNavigationItem>:
    # These ids are accessed from Python via self.library_tab.ids[...]
    name: "Screen 3"
    text: "Library"
    MDBoxLayout:
        size_hint: 1, 1
        orientation: "horizontal"
        padding: dp(8)
        spacing: dp(8)

        # LEFT: Playlists list
        MDCard:
            size_hint_y: 1
            radius: dp(16)
            min_width: dp(160)
            padding: dp(8)
            style: "filled"
            size_hint_x: 0.4
            MDBoxLayout:
                orientation: "vertical"
                spacing: dp(8)
                MDBoxLayout:
                    size_hint_y: None
                    height: dp(40)
                    MDLabel:
                        text: "Playlists"
                        bold: True
                    MDFillRoundFlatIconButton:
                        size_hint_y: 0.7
                        size_hint_x: 0.2
                        text: "New"
                        icon: "plus"
                        on_release: app.root._playlist_prompt_new()
                RecycleView:
                    id: rv_playlists
                    viewclass: "PlaylistItem"
                    data: []
                    RecycleBoxLayout:
                        default_size: None, dp(48)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: "vertical"

        # RIGHT: Tracks of selected playlist
        MDCard:
            size_hint_y: 1
            radius: dp(16)
            padding: dp(8)
            style: "filled"
            size_hint_x: 0.65
            MDBoxLayout:
                orientation: "vertical"
                spacing: dp(8)

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(40)
                    MDLabel:
                        id: active_playlist_name
                        text: "Tracks"
                        bold: True
                    MDFillRoundFlatIconButton:
                        size_hint_y: 0.7
                        size_hint_x: 0.2
                        text: "Import"
                        icon: "file-plus"
                        on_release: app.root._playlist_import_selective()
                RecycleView:
                    id: rv_tracks
                    viewclass: "TrackItem"
                    data: []
                    RecycleBoxLayout:
                        default_size: None, dp(56)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: "vertical"
